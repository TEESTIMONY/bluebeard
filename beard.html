<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style2.css">

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bowlby+One+SC&family=Chewy&family=Gamja+Flower&family=Hanalei+Fill&family=Knewave&family=Nanum+Pen+Script&family=Patrick+Hand+SC&family=Rubik+Puddles&family=Slackey&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Boogaloo&family=Bowlby+One+SC&family=Chewy&family=Finger+Paint&family=Gamja+Flower&family=Hanalei+Fill&family=Knewave&family=Nanum+Pen+Script&family=Patrick+Hand+SC&family=Rubik+Puddles&family=Shojumaru&family=Slackey&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #347cec;
        }
        .image-container {
            position: relative;
            overflow: hidden;
            border-radius: 10px;
        }
        .movable {
            position: absolute;
        }
        .static-image {
            display: block;
            width: 100%;
            margin-top: 10px;
            border-radius: 10px;
            object-fit: cover;
        }
        .save-btn {
            width: 250px;
            height: 55px;
            text-decoration: none;
            background-color:#fff4b4 ;
            padding: 10px;
            border-radius: 15px;
            text-align: center;
            color: black;
            font-size: 20px;
            font-family: "Shojumaru", serif;
            box-shadow: 3px 3px 8px rgba(0, 0, 0, 1);
            border: 2px solid black;
            cursor: pointer;
            display: none;
        }
        .resizer {
            width: 10px;
            height: 10px;
            background: white;
            border: 1px solid black;
            position: absolute;
            z-index: 1;
            display: none;
        }
        .resizer.topleft {
            top: -5px;
            left: -5px;
            cursor: nwse-resize;
        }
        .resizer.topright {
            top: -5px;
            right: -5px;
            cursor: nesw-resize;
        }
        .resizer.bottomleft {
            bottom: -5px;
            left: -5px;
            cursor: nesw-resize;
        }
        .resizer.bottomright {
            bottom: -5px;
            right: -5px;
            cursor: nwse-resize;
        }
    </style>
</head>
<body class="beard">
    <div class="the-body-container">
        <div class="back-button">
            <a href="index.html" class="back-btn">BACK</a>
        </div>
        <div class="main-container">
            <div class="put-on-text">
                <h1>PUT ON A BEARD</h1>
            </div>
            <div class="image-container">
                <div class="movable">
                    <img src="img7.png" alt="Draggable Image">
                    <div class="resizer topleft"></div>
                    <div class="resizer topright"></div>
                    <div class="resizer bottomleft"></div>
                    <div class="resizer bottomright"></div>
                </div>
            </div>
            <div class="add-img">
                <button class="add-btn">Add Image</button>
                <input type="file" id="fileInput" accept="image/*" style="display: none;">
            </div>
            <button class="save-btn" id="saveImageBtn">Save Image</button>
        </div>
    </div>
    

    <script>
        const container = document.querySelector(".image-container");
        const div = document.querySelector(".movable");
        const fileInput = document.getElementById("fileInput");
        const addBtn = document.querySelector(".add-btn");
        const saveBtn = document.getElementById("saveImageBtn");

        let offsetX, offsetY, isDragging = false;
        let isResizing = false, currentResizer;

        function constrainMovement() {
            const rect = div.getBoundingClientRect();
            const containerRect = container.getBoundingClientRect();

            if (rect.left < containerRect.left) {
                div.style.left = "0px";
            } else if (rect.right > containerRect.right) {
                div.style.left = `${containerRect.width - rect.width}px`;
            }

            if (rect.top < containerRect.top) {
                div.style.top = "0px";
            } else if (rect.bottom > containerRect.bottom) {
                div.style.top = `${containerRect.height - rect.height}px`;
            }
        }

        div.addEventListener("mousedown", (e) => {
            if (!e.target.classList.contains("resizer")) {
                isDragging = true;
                offsetX = e.clientX - div.offsetLeft;
                offsetY = e.clientY - div.offsetTop;
                div.style.cursor = "grabbing";
                div.style.border = "2px solid #babaf5";
                showResizers();
            }
        });

        document.addEventListener("mousemove", (e) => {
            if (isDragging) {
                div.style.left = `${e.clientX - offsetX}px`;
                div.style.top = `${e.clientY - offsetY}px`;
                constrainMovement();
            }
        });

        document.addEventListener("mouseup", () => {
            isDragging = false;
            div.style.cursor = "grab";
        });

        document.addEventListener("mousedown", (e) => {
            if (!div.contains(e.target) && !e.target.classList.contains("resizer")) {
                div.style.border = "none";
                hideResizers();
            }
        });

        const resizers = document.querySelectorAll(".resizer");

        resizers.forEach(resizer => {
            resizer.addEventListener("mousedown", (e) => {
                isResizing = true;
                currentResizer = e.target;
                document.addEventListener("mousemove", resize);
                document.addEventListener("mouseup", stopResize);
                e.stopPropagation();
            });
        });

        function resize(e) {
            if (!isResizing) return;

            const rect = div.getBoundingClientRect();

            if (currentResizer.classList.contains("bottomright")) {
                div.style.width = `${e.clientX - rect.left}px`;
                div.style.height = `${e.clientY - rect.top}px`;
            } else if (currentResizer.classList.contains("bottomleft")) {
                div.style.width = `${rect.right - e.clientX}px`;
                div.style.left = `${e.clientX}px`;
                div.style.height = `${e.clientY - rect.top}px`;
            } else if (currentResizer.classList.contains("topright")) {
                div.style.width = `${e.clientX - rect.left}px`;
                div.style.height = `${rect.bottom - e.clientY}px`;
                div.style.top = `${e.clientY}px`;
            } else if (currentResizer.classList.contains("topleft")) {
                div.style.width = `${rect.right - e.clientX}px`;
                div.style.left = `${e.clientX}px`;
                div.style.height = `${rect.bottom - e.clientY}px`;
                div.style.top = `${e.clientY}px`;
            }
            constrainMovement();
        }

        function stopResize() {
            isResizing = false;
            document.removeEventListener("mousemove", resize);
            document.removeEventListener("mouseup", stopResize);
        }

        function showResizers() {
            resizers.forEach(resizer => {
                resizer.style.display = "block";
            });
        }

        function hideResizers() {
            resizers.forEach(resizer => {
                resizer.style.display = "none";
            });
        }

        document.querySelector(".add-btn").addEventListener("click", () => {
            fileInput.click();
        });

        fileInput.addEventListener("change", (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const newImage = document.createElement("img");
                    newImage.src = event.target.result;
                    newImage.alt = "New Image";
                    newImage.classList.add("static-image");

                    // Add the new image below the existing one
                    container.appendChild(newImage);

                    // Hide the Add Image button
                    addBtn.style.display = "none";  // Hides the "Add Image" button

                    // Change the Add button text to "Save Image" and show the save button
                    addBtn.textContent = "Save Image";
                    saveBtn.style.display = "inline-block";
                };
                reader.readAsDataURL(file);
            }
        });

        saveBtn.addEventListener("click", function() {
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");

            const beardImage = div.querySelector("img"); // Beard image
            const uploadedImage = container.querySelector(".static-image"); // Uploaded image

            // Set canvas size to match the container size
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;

            // Get container and beard positioning
            const containerRect = container.getBoundingClientRect();
            const beardRect = div.getBoundingClientRect();
            const uploadedRect = uploadedImage.getBoundingClientRect();

            // Calculate the position of the beard relative to the container
            const beardX = beardRect.left - containerRect.left;
            const beardY = beardRect.top - containerRect.top;

            // Calculate the position and size of the uploaded image relative to the container
            const uploadedX = uploadedRect.left - containerRect.left;
            const uploadedY = uploadedRect.top - containerRect.top;
            const uploadedWidth = uploadedRect.width;
            const uploadedHeight = uploadedRect.height;

            // Draw the uploaded image
            ctx.drawImage(uploadedImage, uploadedX, uploadedY, uploadedWidth, uploadedHeight);

            // Draw the beard image
            ctx.drawImage(
                beardImage,
                beardX,
                beardY,
                beardRect.width,
                beardRect.height
            );

            // Create downloadable link for the combined image
            const dataUrl = canvas.toDataURL("image/png");
            const link = document.createElement("a");
            link.href = dataUrl;
            link.download = "combined-image.png";
            link.click();
        });
    </script>
</body>
</html>

